<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-json.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-tomorrow.css">
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.bundle.js"></script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
        <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>

        <link rel="stylesheet" href="/css/index.css">
        <link rel="stylesheet" href="/css/tabs.css">
        <script src="/js/charts.js"></script>
        <script src="/js/tabs.js"></script>


        <script type="text/javascript"">
            var initial_stats = {{ initial_stats|tojson|safe }};

            var memory_chart = null
            var message_chart = null
            var color = Chart.helpers.color;

            $(document).ready(function() {
                console.log(initial_stats);
                start_update();
                start_charts();

                $("#toggleStats").click(function() {
                    $("#jsonstats").fadeToggle(1000);
                });

                // Pretty print the config json so it's readable
                var cfg_data = $("#configjson").text();
                var cfg_json = JSON.parse(cfg_data);
                var cfg_pretty = JSON.stringify(cfg_json, null, '\t');
                const html_pretty = Prism.highlight( cfg_pretty, Prism.languages.json, 'json');
                $("#configjson").html(html_pretty);

                $('.ui.accordion').accordion({exclusive: false});
                $('.menu .item').tab('change tab', 'charts-tab');
            });
        </script>
    </head>

    <body>
        <header>
          <div id="title">APRSD <span id="version"></span></div>
          <div id="callsign">{{ callsign }}</div>
          <div id="aprsis"></div>
          <div id="uptime"></div>
        </header>

        <div id="main" class="main ui container">
            <!-- Tab links -->
            <div class="ui tabular menu">
                <div class="active item" data-tab="charts-tab">Charts</div>
                <div class="item" data-tab="msgs-tab">Messages</div>
                <div class="item" data-tab="config-tab">Config</div>
            </div>

            <!-- Tab content -->
            <div class="ui active tab" data-tab="charts-tab">
                <h3>Charts</h3>
                <div id="graphs">
                    <div id="left"><canvas id="messageChart"></canvas></div>
                    <div id="right"><canvas class="right" id="emailChart"></canvas></div>
                </div>
                <div id="graphs_center">
                    <div id="center"><canvas id="memChart"></canvas></div>
                </div>
                <div id="stats">
                    <button id="toggleStats">Toggle raw json</button>
                    <pre id="jsonstats" class="language-json">{{ stats }}</pre>
                </div>
            </div>

            <div class="ui tab" data-tab="msgs-tab">
                <h3>Messages (<span id="packets_count">0</span>)</h3>
              <div class="ui styled fluid accordion" id="accordion">
                  <div id="packetsDiv">
                  </div>
              </div>
            </div>

            <div class="ui tab" data-tab="config-tab">
              <h3>Config</h3>
              <pre id="configjson" class="language-json">{{ config_json|safe }}</pre>
            </div>
        </div>

        <footer>
            <a href="https://badge.fury.io/py/aprsd"><img src="https://badge.fury.io/py/aprsd.svg" alt="PyPI version" height="18"></a>
            <a href="https://github.com/craigerl/aprsd"><img src="https://img.shields.io/badge/Made%20with-Python-1f425f.svg" height="18"></a>
        </footer>
    </body>
</html>
